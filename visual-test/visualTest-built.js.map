{"version":3,"file":"visualTest-built.js","sources":["../src/mvvm/eventObserver.js","../src/mvvm/directive.js","../src/mvvm/compile.js","../src/mvvm/mvvm.js","../src/ctx.js","../src/util.js","../src/listener.js","../src/index.js","../src/rest.js","../src/router.js","visualTest.js"],"sourcesContent":["// 事件循环周期 单位毫秒\nconst EVENT_LOOP_DURATION = 100\nconst RESERVED_PROP_NAMES = ['__eventQueue', '__handlerQueue', '__intervalID', 'startObserve', 'stopObserve', 'onChange', '__observe__', '__scope__', '__get__', '__set__']\n/** array 代理操作 */\nconst ARRAY_ORP = ['push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse']\n\n/**\n * 对非 Array 类型的对象进行深度观察，提供事件接口\n * 非 Array 对象的深层次的属性变化会向上冒泡，冒泡可以通过 event.stopPropagate() 停止\n * data 在被传入后，数据结构不应该被改变，也不应该有新的字段加入，除非是 Array 索引赋值，避免把非原始类型复制给字段\n * 对 Array 不作深度观察以提高性能 arr[0] = '' 这样的操作可以被观察到，但是 arr[1].name = 'xxx 不会被观察到\n */\nexport default class ObserverableObject {\n  constructor(data) {\n    this.__eventQueue = []\n    this.__handlerQueue = {}\n    this.__intervalID = null\n    Object.keys(data).forEach((key) => {\n      if (RESERVED_PROP_NAMES.filter((x) => x === key).length > 0) {\n        throw new Error('reserved prop name')\n      }\n    })\n    Object.assign(this, data)\n    ObserverableObject.observe(this, '', this)\n  }\n  /**\n    * @param {Oberserverable} observerable 观察者\n    * @param {string} key parentkey.childkey 形式\n    * @returns {any} value\n    */\n  static __get__(observerable, key) {\n    if (key.indexOf('.') === -1) {\n      return observerable[key]\n    }\n    const keys = key.split('.')\n    const ctxkeys = keys.slice(0, keys.length - 1)\n    let ctx = observerable\n    ctxkeys.forEach(\n      (x) => {\n        ctx = ctx[x]\n      }\n    )\n    return ctx[keys[keys.length - 1]]\n  }\n  /**\n    *@param {Oberserverable} observerable 观察者\n   * @param {string} key parentkey.childkey 形式\n   * @param {any}  value 值\n   * @returns {undefined}\n   */\n  static __set__(observerable, key, value) {\n    if (key.indexOf('.') === -1) {\n      observerable[key] = value\n    }\n    const keys = key.split('.')\n    const ctxkeys = keys.slice(0, keys.length - 1)\n    let ctx = observerable\n    ctxkeys.forEach(\n      (x) => {\n        ctx = ctx[x]\n      }\n    )\n    ctx[keys[keys.length - 1]] = value\n  }\n  /**\n   * 检查 prop 是否是保留字\n   * @param {string} prop 待检测的 prop\n   * @returns {boolean} 是否是保留字\n   */\n  static isReservedProp(prop) {\n    let isReservedProp = false\n    if (RESERVED_PROP_NAMES.filter((x) => x === prop).length > 0) {\n      isReservedProp = true\n    }\n    return isReservedProp\n  }\n  static observe(data, scope, observer) {\n    const checkReserved = !(data instanceof ObserverableObject)\n    if (typeof data !== 'object') {\n      throw new TypeError('data must be object')\n    }\n    if (Array.isArray(data)) {\n      ARRAY_ORP.forEach((opt) => {\n        Object.defineProperty(data, opt, {\n          enumerable: false,\n          configurable: true,\n          value() {\n            ObserverableObject.removeObserve(data, false)\n            Array.prototype[opt].apply(data, arguments)\n            const event = new ChangeEvent()\n            event.changedKey = scope\n            event.target = data\n            observer.trigger(event)\n            Object.keys(data).forEach((key) => {\n              ObserverableObject.defineProperty(data, key, data[key], observer, scope)\n            })\n          }\n        })\n      })\n      Object.keys(data).forEach((key) => {\n        if (!checkReserved && ObserverableObject.isReservedProp(key)) {\n          return\n        }\n        ObserverableObject.defineProperty(data, key, data[key], observer, scope)\n      })\n      return\n    }\n    Object.keys(data).forEach((key) => {\n      if (!checkReserved && ObserverableObject.isReservedProp(key)) {\n        return\n      }\n      ObserverableObject.defineProperty(data, key, data[key], observer, scope)\n      if (typeof data[key] === 'object') {\n        const childScope = scope === '' ? key : `${scope}.${key}`\n        ObserverableObject.observe(data[key], childScope, observer)\n      }\n    })\n  }\n  /**\n   * 开始观察，监听变化\n   * @returns {ObserberableObject} 返回自己\n   */\n  startObserve() {\n    this.__intervalID = setInterval(() => {\n      if (this.__eventQueue.length > 0) {\n        const event = this.__eventQueue.shift()\n        if (this.__handlerQueue[event.changedKey]) {\n          this.__handlerQueue[event.changedKey].forEach((fn) => fn(event))\n        }\n        const handlersSet = Object.keys(this.__handlerQueue).filter((x) => event.changedKey.startsWith(x) && x !== event.changedKey)\n          .sort(\n            (a, b) => b.length - a.length\n          )\n          .map(\n            (x) => this.__handlerQueue[x]\n          )\n        if (!handlersSet || handlersSet.length === 0) {\n          return\n        }\n        for (let i = 0; i < handlersSet.length; i++) {\n          if (event._isStopPropagated) {\n            break\n          }\n          handlersSet[i].forEach((fn) => fn(event))\n        }\n      }\n    }, EVENT_LOOP_DURATION)\n    return this\n  }\n  /**\n   * 停止观察，取消监听\n   * @returns {ObserberableObject} 返回自己\n   */\n  stopObserve() {\n    if (this.__intervalID) {\n      clearInterval(this._intervalID)\n      this._intervalID = null\n    }\n    return this\n  }\n  /**\n   * @param {string} changedKey 监听变化的 prop，可以是 prop.prop.prop 嵌套形式\n   * @param {Function} handler  接受参数为 ChangeEvent 类型的 handler\n   * @returns {ObserberableObject} 返回自己\n   */\n  onChange(changedKey, handler) {\n    if (!this.__handlerQueue[changedKey]) {\n      this.__handlerQueue[changedKey] = []\n    }\n    this.__handlerQueue[changedKey].push(handler)\n    return this\n  }\n  /**\n   * @param {ChaneeEvent} event 触发事件\n   * @returns {ObserberableObject} 返回自己\n   */\n  trigger(event) {\n    this.__eventQueue.push(event)\n    return this\n  }\n  /**\n   * @param {Object} obj 被观察的对象\n   * @param {string} prop 需要被观察的对象的属性名\n   * @param {any} value 被观察对象的属性名的初始属性值\n   * @param {ObserverableObject} observerable 事件管理者\n   * @param {string} scope 属性值空间\n   * @param {boolean} checkReserved 是否检查命名冲突\n   * @returns {undefined}\n   */\n  static defineProperty(obj, prop, value, observerable, scope) {\n    RESERVED_PROP_NAMES.forEach((name) => {\n      if (name === prop) {\n        throw new Error('reserved prop name')\n      }\n    })\n    const _scope = scope || ''\n    if (!obj.__observe__) {\n      Object.defineProperty(obj, '__observe__', {\n        configurable: true,\n        enumerable: false,\n        value: {}\n      })\n    }\n    const __observe__ = obj.__observe__\n    __observe__[prop] = value\n    if (typeof obj.__scope__ === 'undefined') {\n      Object.defineProperty(obj, '__scope__', {\n        configurable: true,\n        enumerable: false,\n        value: _scope\n      })\n    }\n    Object.defineProperty(obj, prop, {\n      get() {\n        return __observe__[prop]\n      },\n      set(newVal) {\n        if (newVal !== __observe__[prop]) {\n          if (typeof __observe__[prop] === 'object') {\n            ObserverableObject.removeObserve(__observe__[prop])\n          }\n          __observe__[prop] = newVal\n          const changeEvent = new ChangeEvent()\n          const changedKey = _scope === '' ? prop : `${_scope}.${prop}`\n          changeEvent.target = obj\n          changeEvent.changedKey = changedKey\n          observerable.trigger(changeEvent)\n          if (typeof newVal === 'object') {\n            ObserverableObject.observe(newVal, changedKey, observerable)\n          }\n        }\n      }\n    })\n  }\n  /**\n   * 取消观察\n   * @param {ObserverableObject} obj 要取消观察的对象\n   * @param {boolean} recursively 是否递归操作\n   * @returns {undefined}\n   */\n  static removeObserve(obj, recursively) {\n    if (typeof recursively === 'undefined') {\n      recursively = true\n    }\n    const __observe__ = obj.__observe__\n    if (!__observe__) {\n      return\n    }\n    Object.keys(obj).forEach((prop) => {\n      if (ObserverableObject.isReservedProp(prop)) {\n        return\n      }\n\n      Object.defineProperty(obj, prop, {\n        get() {\n          return __observe__[prop]\n        },\n        set(newVal) {\n          if (newVal !== __observe__[prop]) {\n            __observe__[prop] = newVal\n          }\n        }\n      })\n      if (typeof obj[prop] === 'object' && recursively) {\n        ObserverableObject.removeObserve(obj[prop])\n      }\n    })\n  }\n}\n\nclass ChangeEvent {\n  constructor() {\n    this.target = null\n    this.changedKey = null\n    this._isStopPropagated = false\n  }\n  stopPropagate() {\n    this._isStopPropagated = true\n  }\n}\n","export const PREFIX = 'sp-'\nimport ObserverableObject from './eventObserver'\n\nclass Directive {\n  constructor(raw, scope) {\n    this._scope = scope\n    this._raw = raw\n  }\n  unbind() {\n    return null\n  }\n}\n\n// sp-text 指令\nexport class TextDirective extends Directive {\n  static New(raw, scope) {\n    return new TextDirective(raw, scope)\n  }\n  /**\n   * 同步数据模型到视图的单向绑定\n   * @param {Observer} observerable 可观察的对象\n   * @returns {undefined}\n   */\n  bind(observerable) {\n    this._observerable = observerable\n    this._scope.$el.text(ObserverableObject.__get__(this._observerable, this._raw))\n    this._observerable.onChange(this._raw, () => {\n      this._scope.$el.text(ObserverableObject.__get__(this._observerable, this._raw))\n    })\n  }\n}\n\n// sp-bind 指令\nexport class InputBindDirective extends Directive {\n  static New(raw, scope) {\n    return new InputBindDirective(raw, scope)\n  }\n  /**\n   * 表单到模型的双向绑定\n   * @param {Observerable} observerable 可观察的对象\n   * @returns {undefined}\n   */\n  bind(observerable) {\n    this._observerable = observerable\n    this._scope.$el.val(ObserverableObject.__get__(this._observerable, this._raw))\n    this._observerable.onChange(this._raw, () => {\n      this._scope.$el.val(ObserverableObject.__get__(this._observerable, this._raw))\n    })\n    this._scope.$el.on('input', () => {\n      ObserverableObject.__set__(this._observerable, this._raw, this._scope.$el.val())\n    })\n  }\n  unbind() {\n    this._scope.$el.off('input')\n  }\n}\n\n// sp-click 指令\nexport class ClickDirective extends Directive {\n  static New(raw, scope) {\n    return new ClickDirective(raw, scope)\n  }\n  /**\n   * 表单到模型的双向绑定\n   * @param {Observerable} observerable 可观察的对象\n   * @returns {undefined}\n   */\n  bind(observerable) {\n    this._observerable = observerable\n    this._scope.$el.on('click', (event) => {\n      this._observerable[this._raw](event)\n    })\n  }\n  unbind() {\n    this._scope.$el.off('click')\n  }\n}\n/**\n * 索引\n */\nexport const DIRECTIVES = {\n  bind: InputBindDirective,\n  text: TextDirective,\n  click: ClickDirective\n}\n","import {PREFIX, DIRECTIVES} from './directive'\nconst DIRECTIVE_PATTERN = new RegExp(`${PREFIX}(\\\\w+)`)\nimport $ from 'jquery'\n/**\n * @param {$} $element 文档节点\n * @param {Observer} observerable 绑定到的数据模型\n * @returns {Array} directives\n */\nexport default function compileTemplate($element, observerable) {\n  const directives = []\n  if ($element.children() && $element.children().length > 0) {\n    $element.children().each((index, el) => {\n      const parseResult = parseElement($(el), observerable)\n      if (parseResult) {\n        parseResult.forEach((d) => directives.push(d))\n      }\n      const compileResult = compileTemplate($(el), observerable)\n      // compileResult 如果是 array 必须非空再 append\n      if (compileResult && compileResult.length > 0) {\n        compileResult.forEach((d) => directives.push(d))\n      }\n    })\n  }\n  return directives\n}\n\n/**\n * 解析指令\n * @param {Jquery} $el 需要解析的文档节点\n * @param {Object} observerable 数据模型\n * @returns {Array} directives\n */\nfunction parseElement($el, observerable) {\n  if ($el.length === 0) {\n    return null\n  }\n  const attributes = Array.from($el[0].attributes) || []\n  const scope = {\n    $parent: $el.parent(),\n    $next: $el.next(),\n    $el\n  }\n  const directives = []\n  attributes.forEach((attr) => {\n    const raw = attr.value\n    const directiveName = isDirecitve(attr.name)\n    const directiveType = directiveName && DIRECTIVES[directiveName]\n    if (directiveName && directiveType) {\n      const directive = directiveType.New(raw, scope)\n      directive.bind(observerable)\n      directives.push(directive)\n    }\n  })\n  return directives.length !== 0 && directives\n}\n\n/**\n * @param {string} attr 指令\n * @returns {string} 匹配到的字符\n */\nexport function isDirecitve(attr) {\n  const matchResult = attr.match(DIRECTIVE_PATTERN)\n  return matchResult && matchResult[1] || ''\n}\n","import Observer from './eventObserver'\nimport compileTemplate from './compile'\nimport $ from 'jquery'\n\nexport default class MVVM {\n  /**\n   * @param {string} el 构建虚拟 dom 的 html 文本\n   * @param {Function} dataFactory return model\n   */\n  constructor(el, dataFactory) {\n    this._dataFactory = dataFactory\n    if (typeof el === 'string') {\n      el = el.trim()\n    }\n    this._$el = $(el)\n    this._created = false\n  }\n  /**\n   * @param {Object} context 来自 router 解析的 rest 参数\n   * @returns {undefined}\n   */\n  create(context) {\n    this.hooks = {\n      onMount: [],\n      onUnmount: [],\n      onDestroy: []\n    }\n    const data = this._dataFactory()\n    this._observerable = new Observer(data)\n    Object.keys(data).filter((key) => typeof data[key] === 'function')\n      .forEach((key) => {\n        this._observerable[key] = data[key]\n      })\n    this._directives = compileTemplate(this._$el, this._observerable)\n    this._observerable.startObserve()\n    if (typeof data.onCreate === 'function') {\n      data.onCreate.call(this._observerable, context)\n    }\n    if (typeof data.onMount === 'function') {\n      this.hooks.onMount.push(\n        data.onMount.bind(this._observerable)\n      )\n    }\n    if (typeof data.onUnmount === 'function') {\n      this.hooks.onUnmount.push(\n        data.onUnmount.bind(this._observerable)\n      )\n    }\n    if (typeof data.onDestroy === 'function') {\n      this.hooks.onDestroy.push(\n        data.onDestroy.bind(this._observerable)\n      )\n    }\n    this._created = true\n  }\n  // 挂载\n  mount() {\n    this.hooks.onMount.forEach((fn) => fn())\n  }\n  // 取消挂载\n  unmount() {\n    this.hooks.onUnmount.forEach((fn) => fn())\n  }\n  // 销毁\n  destroy() {\n    if (this._created) {\n      this._observer.stopObserve()\n      this.hooks = {\n        onMount: [],\n        onUnmount: [],\n        onDestroy: []\n      }\n      this.hooks.onMount.forEach((fn) => fn())\n      this._created = false\n      this._directives.forEach((d) => {\n        d.unbind()\n      })\n    }\n  }\n  $el() {\n    return this._$el\n  }\n}\n","export const OK = 200\n// NAME_SPACE 防止命名冲突\nexport const NAME_SPACE =  {\n  RESOLVER_CTX_KEY : 'spa.resolver',\n  FILTER_CTX_KEY : 'spa.filter',\n  ROUTER_CTX_KEY: 'spa.router',\n  HISTORY_CTX_KEY: 'spa.history'\n}\n\n// Context 用于中间件之间进行通信\nexport class Context {\n  constructor() {\n    this.hash = ''\n    this.RestParams = {}\n  }\n  redirect(hash) {\n    this.hash = hash\n    window.location.hash = hash\n    return this\n  }\n}\n","const DATA_KEY = 'spa.data'\nlet uid = 0\n// 工具类\nexport default class Util {\n  // 中间件组合器\n  static composeMiddlewares(funcs) {\n    return Util._reduceReverse(funcs, (b, a) => function (ctx) {\n      a(ctx, b)\n    })\n  }\n  static _reduceReverse(arr, func) {\n    let last = arr[arr.length - 1]\n    arr.reverse().forEach((el) => {\n      last = func(last, el)\n    })\n    return last\n  }\n  static GlobalData(key, value) {\n    if (typeof value === 'undefined') {\n      return window[DATA_KEY] && window[DATA_KEY][key]\n    }\n    if (typeof window[DATA_KEY] !== 'object') {\n      window[DATA_KEY] = {}\n    }\n    window[DATA_KEY][key] = value\n    return Util\n  }\n  static noop() {\n    return null\n  }\n  static cookie(key, val) {\n    if (typeof val === 'undefined') {\n      const cookie = document.cookie.split(';')\n        .map((x) => x.replace(/^\\s+/, '')\n        )\n        .reduce((a, b) => {\n          a[b.split('=')[0]] = b.split('=')[1]\n          return a\n        }, {})\n      return cookie[key]\n    }\n    document.cookie = `${key}=${val}`\n    return this\n  }\n\n  // 匹配器，匹配成功返回 rest 参数 失败返回 null\n  // hash /main/1022 pattern: /main/:uid => {uid: 1022}\n  static matcher(hash, pattern) {\n    const patternItems = pattern.split('/').filter((x) => x).map((x) => {\n      if (x.startsWith(':')) {\n        return {\n          rest: true,\n          key: x.slice(1)\n        }\n      }\n      return {\n        rest: false,\n        key: x\n      }\n    })\n\n    const hashToken = Util.hashParser(hash)\n    if (patternItems.length !== hashToken.path.length) {\n      return null\n    }\n    let matched = true\n    const result = {}\n    patternItems.forEach((x, index) => {\n      if (x.rest) {\n        result[x.key] = hashToken.path[index]\n        return\n      }\n      if (x.key !== hashToken.path[index]) {\n        matched = false\n      }\n    })\n    return matched ? result : null\n  }\n  static uid() {\n    return uid++\n  }\n  // hash 解析器，返回 token\n  // http://localhost/#path/ssvxs/211?search=url&name=formater\n  // => [path, ssvxs , 211], {search: 'url', name : 'formater'}\n  static hashParser(hash) {\n    hash = decodeURIComponent(hash)\n    let queries = hash.split('?')[1]\n    if (queries) {\n      queries = queries.split('&').filter((x) => x)\n        .reduce((a, b) => {\n          const key = b.split('=')[0]\n          const val = b.split('=')[1]\n          a[key] = val\n          return a\n        }, {})\n    }\n    return {\n      path: hash.split('?')[0].split('/').filter((x) => x),\n      queries\n    }\n  }\n  // jsonp 接口用于调远程用户数据\n  static jsonp(params, url, callback) {\n    const callbackName = `func${Util.uid()}`\n    const element = document.createElement('script')\n    let queries = Object.keys(params).reduce((prev, key) => `${prev}${encodeURIComponent(key)}=${encodeURIComponent(params[key])}&`\n      , '')\n    queries = queries[queries.length - 1] === '&' ? queries.slice(0, queries.length - 1) : queries\n    element.src = `${url}?callback=${callbackName}&${queries}`\n    window[callbackName] = (data) => {\n      callback(data)\n      delete window[callbackName]\n      document.body.removeChild(element)\n    }\n    document.body.appendChild(element)\n  }\n}\n","// ctx 的命名空间\nimport Util from './util'\n\n\nexport default function listener(ctx, next) {\n  const prevHash = Util.GlobalData('hash')\n  Util.GlobalData('hash', ctx.hash)\n  // 第一次 listen\n  if (typeof prevHash === 'undefined') {\n    return next && next(ctx)\n  }\n  if (ctx.hash === prevHash) {\n    return ''\n  }\n  return next && next(ctx)\n}\n\n","import {Context} from './ctx'\nimport Util from './util'\nimport Listener from './listener'\nconst refreshEvery = 200\nclass SPA {\n  constructor() {\n    this._middlewares = []\n    this.use(Listener)\n  }\n  // 中间件接口\n  use(middleware) {\n    this._middlewares.push(middleware)\n    return this\n  }\n  // 中间件 compose\n  init() {\n    this._app = Util.composeMiddlewares(this._middlewares) || Util.noop\n    return this\n  }\n  // 生成 app\n  app() {\n    const _app = this._app\n    return () => setInterval(() => {\n      const ctx = new Context()\n      ctx.hash = window.location.hash && window.location.hash.slice(1)\n      _app(ctx)\n    }, refreshEvery)\n  }\n  start() {\n    this.init()\n    this.app()()\n  }\n}\n\nexport default function (config) {\n  return new SPA(config)\n}\n","import Util from './util'\n\n// Rest rest 参数解析 和 重写规则\nexport class Rest {\n  constructor(config) {\n    this._config = config\n  }\n  middleware() {\n    return (ctx, next) => {\n      const rules = Object.keys(this._config)\n      for (let i = 0; i < rules.length; i++) {\n        const matchResult = Util.matcher(ctx.hash, rules[i])\n        if (matchResult !== null) {\n          ctx.hash = rules[i]\n          ctx.RestParams = matchResult\n        }\n      }\n      return next && next(ctx)\n    }\n  }\n}\n\nexport default function (config) {\n  return (new Rest(config)).middleware()\n}\n","import Rest from './rest'\nimport Util from './util'\nimport $ from 'jquery'\nconst ROUTER_PLACEHOLDER_TAG_NAME = 'router-view'\n// Router 把地址路由到 mvvm\nexport class Router {\n  constructor(config) {\n    this._slot = new RouterSlot(document.querySelector(ROUTER_PLACEHOLDER_TAG_NAME))\n    this._config = config\n    this._rest = Rest(config)\n  }\n  // 根据地址挂载虚拟 dom\n  middleware() {\n    const router = (ctx, next) => {\n      let hash = ctx.hash\n      if (!hash) {\n        hash = '/'\n      }\n      this._slot.unmount()\n      const rules = Object.keys(this._config)\n      let mounted = false\n      for (let i = 0; i < rules.length; i++) {\n        const rule = rules[i]\n        const mvvm = this._config[rules[i]]\n        if (rule === hash && !mounted) {\n          this._slot.mount(mvvm, ctx.RestParams)\n          mounted = true\n          break\n        }\n      }\n      if (!mounted) {\n        this._slot.mount(this._config['/'], ctx.RestParams)\n      }\n      return next && next(ctx)\n    }\n    return Util.composeMiddlewares([this._rest, router])\n  }\n}\n\nexport default function (config) {\n  if (typeof config === 'undefined') {\n    throw TypeError('config cannot be undefined')\n  }\n  return (new Router(config)).middleware()\n}\n\nexport class RouterSlot {\n  /**\n   * @param {HTMLElement} el 起到占位作用的 html element\n   */\n  constructor(el) {\n    this._el = el\n    this._previous = el.previousElementSibling\n    this._parent = el.parentElement\n    $(el).remove()\n    this._mounted = false\n    this._mvvm = null\n  }\n  // 挂载 mvvm\n  mount(mvvm, context) {\n    if (this._mounted && this._mvvm === mvvm) {\n      return\n    }\n    if (this._mounted && this._mvvm !== mvvm) {\n      this.unmount()\n    }\n    if (!mvvm._created) {\n      mvvm.create(context)\n    }\n    if (!this._previous) {\n      $(this._parent).prepend(\n        mvvm.$el()\n      )\n    } else {\n      $(this._previous).after(mvvm.$el())\n    }\n    this._mounted = true\n    this._mvvm = mvvm\n    this._mvvm.mount()\n  }\n  // 取消挂载 mvvm\n  unmount() {\n    if (this._mounted) {\n      this._mvvm.$el().detach()\n      this._mvvm.unmount()\n      this._mvvm = null\n      this._mounted = false\n    }\n  }\n}\n","import ObserverableObject from '../src/mvvm/eventObserver'\r\nimport MVVM from '../src/mvvm/mvvm'\r\nimport SPA from '../src/index'\r\nimport Router from '../src/router'\r\nwindow.passedTest = 0\r\nwindow.testCases = 0\r\nfunction assert(bool, msg){\r\n    if (!bool){\r\n        throw msg\r\n    }\r\n}\r\n\r\nwindow.testCases ++\r\nlet o = new ObserverableObject({\r\n    key: 'val'\r\n})\r\n\r\no.startObserve()\r\n\r\no.onChange('key', function(event){\r\n    assert(event.target === o)\r\n    window.passedTest ++\r\n})\r\n\r\no.key = ''\r\n\r\n// 测试深层 array 操作\r\nwindow.testCases++\r\nlet o2 = new ObserverableObject({\r\n    key: 'val',\r\n    key1 : {\r\n        key2 : ['xxx', 'yyyy']\r\n    }\r\n})\r\n\r\no2.startObserve()\r\n\r\no2.onChange('key1', function (event) {\r\n    assert(event.target === o2.key1.key2)\r\n    assert(event.changedKey === 'key1.key2')\r\n    window.passedTest++\r\n})\r\n\r\no2.key1.key2.push('')\r\n\r\n\r\nwindow.testCases++\r\nlet o3 = new ObserverableObject({key:[1, 2, 3, {\r\n    a: 'b'\r\n}]})\r\n\r\no3.startObserve()\r\n\r\no3.onChange('key', function(event){\r\n    assert(event.target === o3)\r\n    window.passedTest++\r\n})\r\n\r\no3.key = ''\r\n\r\n// 测试 array 操作\r\nwindow.testCases++\r\nlet o4 = new ObserverableObject({key: [1, 2, 3, {\r\n    a: 'b'\r\n}]})\r\n\r\no4.startObserve()\r\n\r\no4.onChange('key', function (event) {\r\n    window.passedTest++\r\n})\r\n\r\no4.key.push(9)\r\n\r\n\r\n// 测试重新赋值 array 操作\r\nwindow.testCases += 5\r\nlet o5 = new ObserverableObject({\r\n    key: [1, 2, 3, {\r\n        a: 'b'\r\n    }]\r\n})\r\n\r\no5.startObserve()\r\n\r\no5.onChange('key', function (event) {\r\n    window.passedTest++\r\n})\r\n\r\no5.key = {ttt: 'xxx'}\r\n\r\no5.key.ttt = ' '\r\n\r\no5.key = []\r\no5.key.push({\r\n    xxx: 'ffff'\r\n})\r\no5.key.shift()\r\n\r\n// 测试 array 赋值操作可以被观察到\r\nlet o6 = new ObserverableObject({\r\n    users: [    \r\n        {\r\n            name: 'salpadding',\r\n        },\r\n        {\r\n            name: '------',\r\n        },\r\n        {\r\n            name: '++++',\r\n        },\r\n        {\r\n            name: 'xxxxxx',\r\n        },\r\n    ],\r\n    info:{\r\n        hhh: 'hhhh'\r\n    }\r\n})\r\n\r\nwindow.testCases += 3\r\no6.onChange('users', function (event) {\r\n    window.passedTest++\r\n})\r\no6.onChange('info', function () {\r\n    window.passedTest++\r\n})\r\no6.startObserve()\r\nlet u = {name: 'yyyy'}\r\no6.users.push(u)\r\nlet info = o6.info\r\no6.info = {}\r\ninfo.hhh ='xxxxx'\r\no6.users[0] = {\r\n    name: 'xxxx'\r\n}\r\n\r\n\r\nlet o7 = new ObserverableObject({\r\n    users: [\r\n        {\r\n            name: 'salpadding',\r\n        },\r\n        {\r\n            name: '------',\r\n        },\r\n        {\r\n            name: '++++',\r\n        },\r\n        {\r\n            name: 'xxxxxx',\r\n        },\r\n    ],\r\n    info: {\r\n        hhh: 'hhhh'\r\n    }\r\n})\r\n\r\n// 测试 get set\r\nassert(ObserverableObject.__get__(o7,'info.hhh') === 'hhhh')\r\nObserverableObject.__set__(o7, 'info.hhh', 'xxx')\r\nassert(ObserverableObject.__get__(o7, 'info.hhh') === 'xxx')\r\n\r\nsetTimeout(() => {\r\n    window.passedTest === window.testCases\r\n}, 1000);\r\n\r\nconst loginMVVM = new MVVM(`\r\n    <form id=\"form\">\r\n        <label>输入的用户名是：</label><span sp-text=\"username\"></span>\r\n        <div class=\"form-group\">\r\n            <input sp-bind=\"username\" type=\"text\" class=\"form-control\" id=\"exampleInputEmail1\" aria-describedby=\"emailHelp\" placeholder=\"Enter username\">\r\n            <small id=\"emailHelp\" class=\"form-text text-muted\">We'll never share your email with anyone else.</small>\r\n        </div>\r\n        <a  sp-click=\"onClick\" href=\"\" class=\"btn btn-primary\">Submit</a>\r\n    </form>\r\n`, () => {return {\r\n    username: 'salpadding',\r\n    onClick(event) {\r\n        event.preventDefault()\r\n        window.location.hash =`/info/${this.username}`\r\n    }\r\n}})\r\n\r\n\r\nconst infoMVVM = new MVVM(`\r\n    <div class=\"card\" style=\"width: 18rem;\">\r\n    <div class=\"card-body\">\r\n        <h5 class=\"card-title\" sp-text=\"username\"></h5>\r\n        <h6 class=\"card-subtitle mb-2 text-muted\">Card subtitle</h6>\r\n        <p class=\"card-text\">Some quick example text to build on the card title and make up the bulk of the card's content.</p>\r\n        <a href=\"#\" v-click=\"onClick\" class=\"card-link\">修改用户名</a>\r\n        <a id=\"logout\" href=\"#/login\" class=\"card-link\">logout</a>\r\n        <input sp-bind=\"username\" type=\"text\">\r\n    </div>\r\n    </div>\r\n`, () => {return {\r\n    username: 'salpadding',\r\n    onCreate(restParams) {\r\n        this.username = restParams.username || ''\r\n    },\r\n    onClick(event){\r\n        event.preventDefault()\r\n        \r\n    }\r\n}})\r\n\r\nconst app = SPA()\r\napp.use(\r\n    Router({\r\n        '/' : loginMVVM,\r\n        '/login' : loginMVVM,\r\n        '/info/:username' : infoMVVM\r\n    })\r\n)\r\n\r\napp.start()"],"names":["EVENT_LOOP_DURATION","RESERVED_PROP_NAMES","ARRAY_ORP","ObserverableObject","data","__eventQueue","__handlerQueue","__intervalID","keys","forEach","key","filter","x","length","Error","assign","observe","__get__","observerable","indexOf","split","ctxkeys","slice","ctx","__set__","value","isReservedProp","prop","scope","observer","checkReserved","TypeError","Array","isArray","opt","defineProperty","removeObserve","prototype","apply","arguments","event","ChangeEvent","changedKey","target","trigger","childScope","setInterval","shift","fn","handlersSet","Object","startsWith","sort","a","b","map","i","_isStopPropagated","_intervalID","handler","push","obj","name","_scope","__observe__","__scope__","newVal","changeEvent","recursively","PREFIX","Directive","raw","_raw","TextDirective","New","_observerable","$el","text","onChange","InputBindDirective","val","on","off","ClickDirective","DIRECTIVES","DIRECTIVE_PATTERN","RegExp","compileTemplate","$element","directives","children","each","index","el","parseResult","parseElement","$","d","compileResult","attributes","from","parent","next","attr","directiveName","isDirecitve","directiveType","directive","bind","matchResult","match","MVVM","dataFactory","_dataFactory","trim","_$el","_created","context","hooks","Observer","_directives","startObserve","onCreate","call","onMount","onUnmount","onDestroy","_observer","stopObserve","unbind","Context","hash","RestParams","location","DATA_KEY","uid","Util","composeMiddlewares","funcs","_reduceReverse","arr","func","last","reverse","GlobalData","window","noop","cookie","document","replace","reduce","matcher","pattern","patternItems","hashToken","hashParser","path","matched","result","rest","decodeURIComponent","queries","jsonp","params","url","callback","callbackName","element","createElement","prev","encodeURIComponent","src","body","removeChild","appendChild","listener","prevHash","refreshEvery","SPA","_middlewares","use","Listener","middleware","_app","init","app","config","Rest","_config","rules","ROUTER_PLACEHOLDER_TAG_NAME","Router","_slot","RouterSlot","querySelector","_rest","router","unmount","mounted","rule","mvvm","mount","_el","_previous","previousElementSibling","_parent","parentElement","remove","_mounted","_mvvm","create","prepend","after","detach","passedTest","testCases","assert","bool","msg","o","o2","key1","key2","o3","o4","o5","ttt","o6","u","users","info","hhh","o7","setTimeout","loginMVVM","preventDefault","username","infoMVVM","restParams","start"],"mappings":"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"}